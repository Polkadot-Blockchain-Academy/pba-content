# Consensus Systems

---

### Speaker

Joshy Orndorff

---

### Consensus is

A decision making process that strives to achieve acceptance of the decision by all participants.

Notes:
If we have external factors like trust relationships or Social heirarchy it can be quite easy.

Trust example: If everyone trusts each other, then any one person can propose an outcome, and all the others will trust that it is in the communites best interest.

Social Heirarchy example: If a community has an executive (President, King, CEO), the executive can propose her preference and everyone will accept it based o nthe external mechanism that keeps her as the executive.

But these conditions are not interesting, and are often not realistic. It gets interesting when we don't make these simplifying assumption.

---

### Adversarial Conditions

* The participants want to agree on _something_
* They dont trust each other
* Some could be faulty, or make mistakes
* Some could be straight up malicious

---

### Desired Properties

All honest participants...

* Termination - Eventually reach some decision
* Agreement - Reach the same decision
* Integrity - Reach at most one decision, which was proposed by at least one participant.

---v

### Also Validity

If all participants unanimously propose the same decision , all honest participnts reach that decision.

Notes:
Another desireable property that is sometimes too obvious to say

---

### Example 1: Where to go for dinner

<div class = "left">
![Stan, Kyle, Kenny, and Cartman trying to decide where to eat](https://southparkstudios.mtvnimages.com/images/shows/south-park/clip-thumbnails/season-14/1402/south-park-s14e02c03-ill-show-them-f-obscene-16x9.jpg)
</div>

<div class = "right">
* Termination - Stan, Kyle, and Kenny will each eventually decide where to eat.
* Agreement - Stan, Kyle, and Kenny will each decide to eat at the same place.
* Integrity - Stan, Kyle, and Kenny will eat at either Whistlin' Willies or Casa Bonita.
</div>

Notes:
Stan, Kyle, Kenny, and Cartman are trying to decide where to have dinner.
Stan, Kyle, and Kenny want to have something yummy and spend time together. Cartman is secretly pursuing his own goals and doesn't care whether dinner is yummy. In fact he secretly hopes they won't decide at all so he can go home and eat KFC with his mom.

Stan and Kyle both propose Whistlin' Willie's for dinner. Kenny and Cartman propose Casa Bonita.

---v

### Example 2: Which side of the road to drive on

In the last module we discussed the coordination game and its two Nash equilibria. We discussed that if there is no communication allowed among participants, a Shelling point may help.

Luckily in real life, communication is possible so we can run a consensus algorithm rather than 

* Termination -
* Agreement -
* Integrity -

Notes:
Someone please volunteer to describe what one of these means in this example.


---

### Byzantine Generals Problem

Several divisions of the Byzantine army are camped around an enemy city. They plan to attack the city, but have not yet decided when to attack.

If the attack is coordinated, they will probably be successful, but if it is uncoordinated, they will probably be defeated.

* Termination -
* Agreement -
* Integrity -

Notes:
These examples and many others are _instances_ of the Byzantine Generals Problem

What do our desireable properties mean in terms of this problem.

---

### Synchrony

A system is one of

* Synchronous - When a message is sent, it is received immediately by all recipients.
* Asynchronous - When a message is sent it may be received after some delay, or not at all. The sender doe not know whether it is received. Messages may be recieved in different orders by different parties.
* Partially Synchronous - When a message is sent, it may be received after some delay up to a maxmum delay, $T$. It may not be dropped entirely. Messages may be recieved in different orders by different parties.

---v

### Sync or Async?

Classify each of these:
* Telephone call
* Email
* Text message
* Jitsi video call
* Element chat

Notes:
Answers
* Telephone call - sync
* Email - async
* Text message - sync
* Jitsi video call - sync
* Element chat - IDK actually

---

### Determinism

A system is one of:
* Determinstic - The same inputs give the same outputs every single time.
* Probabalistic - The same inputs may not give the same outputs. Requires a source of entropy. eg coin flipping.

### FLP Impossibility

TODO: Insert diagram

Notes:
Once it was shown that deterministic consensus is impossible in an async network, the field split into two major parts. Either you:
* Assume the network is (at least partially) synchronous
* Introduce non-determinism

One interesting thing about nakamoto pow consensus is that it does _both_.
* Nondeterminism because you don't know who will solve the pow first
* Partial synchrony because it only works if the time to download and execute the block is much less than the time to solve the PoW
---

### Blockchain Consensus

So what are we even trying to decide? A few things:

* Author selection - Who gets to author the next block
* Finality - Which blocks are final

Notes:
Finality is basically like safety. Finality can be proved to entities that are not involved in consensus.

These two decisions can be entirely orthogonal to one another, or wrapped up together. I'll focus on finality first

---

### Long-running Systems

Blockchains are intended to keep processing and finalizing transactions forever. This is more like deciding where to go to dinner every night over and over.











---

### Keeping Authorities Honest

All the blockchain consensus engines we looked at assume some threshold of honest participants. So how do we ensure they are present?

Enter game theory! We can either

* Reward honest behavior
* Punish (aka slash) dishonest behavior

---

### 



---

### 



---

### 



---

### 



---

### 



---

### 



---

### 



---

### 



---

### 



---

### 



---
