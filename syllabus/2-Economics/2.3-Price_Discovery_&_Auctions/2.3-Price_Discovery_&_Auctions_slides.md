---
title: Auctions
description: Auction Basics for Web3 engineers
duration: 1 hour
instructors: ["some one", "another gal"]
teaching-assistants: ["some one", "another gal"]
slideOptions:
  # transition: 'fade'
  # parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'
---

<style>
.reveal p {
  font-size: 24px;
  text-align: left;
}
.reveal {
  font-size: 24px;
  text-align: left;
}

.aligncenter {
    text-align: center;
}
</style>


# Recap: Results of the Experiments (20 minutes)

* [Insert QR code by which players can see the points they gained during the first day. That will be their endowment to bid in the NFT auctions]

Notes:
* Before we start with the auction lecture, we present the results of the experiments that we played with the participants the day before in some slides.

---

## Results: P-Beauty Contest 
* Averages of the different groups.

---

## Results: Public Good Game
* Average contributions per group over time
* Average punishment per group etc.

---

## Results: Prisonner's Dilemma
* Defection and Cooperation rates
* Some examples of the chat boxes

---

## Classroom Discussion (10 min)
* How do the results fit in with the things that we learned in previous lessons?

---

# Lecture 3: Price Finding Mechanisms: Auctions (60 min)

### _Module 3, Lecture 3_


---

# 1. Introduction

---

* A central topic of economics is price finding in markets.
* As we have seen in Lesson 1, a market price must balance supply and demand.
    * Demand: number of items bought by consumers at a given price.
    * Supply: number of items produced at a given price.


![](https://i.imgur.com/FddzOGz.jpg)

---

* While the concepts of supply and demand help us to understand price formation from a general perspective, they do not help that much to understand how firms actually set prices for the goods they sell.
* So, the question of this lesson will be: HOW are prices set in markets?

---

* In many situations, auctions are an optimal way to sell an object.
* Besides analyzing the four most important auction formats, we will also touch upon some of the most important results in auction theory to date:
    * Truthful bidding in a second-price auction.
    * The characterization of optimal auctions.
    * The so-called revenue-equivalence theorem.
* Last, we will discuss what problems blockchain auctions face and why Polkadot employs a candle auction format.

---

# 2. Selling an Object

---

* Think of a firm that offers a product on the market.
* In large markets (with competing firms and many buyers) with a generic product, the easiest way to set the price is often just to post one.
* However, in smaller markets with specific products of limited supply, the optimal strategy is not so clear.

Notes:
* We focus on small(er) markets because much of the blockchain industry still operates in such small markets.

---

* Consider the following setup.
    * There is one firm that has one good to sell.
    * There are two potential buyers, Alice and Bob.
    * Buyers have individual valuations $v_A, v_B \in [0,1]$ for the good. 
* If the valuations $v_A$ and $v_B$ are known to the seller then the solution is simple: approach the higher-valuing buyer and charge a price $p=\max\{v_A,v_B\}$.
* If the valuations are not known to the seller, the problem is trickier.


---

* A canonical model of incomplete information: 
    * A bidder's valuation is only known to themselves.
    * Seller knows that valuations are uniformly and independently distributed.
    * That is, the probability $Pr\{v_A \leq x\}$ is equal to $x$, same for Bob.
* When you don't know their valuations, you could try to negotiate with the buyers.
* Obvious problem: They certainly won't tell you their valuations...

Notes:
* Incomplete information is almost always the case in the real world. 
* Can you think of situations where we exactly know what value a buyer attaches to the good?
* Independent values will be important: when is this (not) a sensible assumption?
* Uniform distribution is just for pedagogical reasons; standard model allows for more general distributions.

---

## 2.1 Price Posting

---

* Alternative: Post a price and sell it to whomever accepts it (sell it to either buyer with a probability 1/2 in case both accept).
* What is the optimal price $p$?
* The revenue of the firm when charging a price $p \in [0,1]$ is $$p[2p(1-p) + (1-p)^2] = p ( 1-p^2).$$ 

![](https://i.imgur.com/BUY6FfZ.png)

Notes: Assuming that 100% of the sale price is profit for the seller, this profit is
* $p$ in case of selling, $0$ otherwise, where
* $[2p(1-p)+(1-p)^2]$ is the probability that at least one buyer accepts (recall: valuations are uniformly distributed).
* So $(1-p)^*$ is the probability that both accept and $2p(1-p)$ is the probability one buyer accepts.
    
---

* The function $p ( 1-p^2)$ is maximized at $p$ satisfying $$ 1-p^2 - 2p^2 = 0 \implies p = \sqrt{1/3}.$$
* Revenue is then $\frac{2}{3}\sqrt{1/3}\approx 0.38.$ 
* Can we do better? Yes, run an auction!

---

## 2.2 Auctions

![](https://i.imgur.com/yLLa8UL.gif)

---

* There are four main auction formats that you should know.
* Static (sometimes called: sealed-bid) auctions: 
    * First-Price Auction: Winner pays her bid.
    * Second-Price Auction: Winner pays second-highest bid.
* Dynamic auctions:
    * English (or: Ascending-price) auction.
    * Dutch (or: Descending-price) auction.

Notes: 
* Sealed-bid comes from the idea that bidders submit their bids in a sealed envelope each; i.e., neither player knows the bid of the others.
* Dutch: Mainly tulips are sold like that in the Netherlands. 

---

# 3. Second-Price Auction

---

* Second-price auction is popular because truthful bidding is an equilibrium!
* Consider the two-bidder case from before: 
    * Alice and Bob know their own valuations $v_A$ and $v_B$.
    * Of the other bidder, each bidder only knows that the valuation is uniformly distributed on $[0,1]$.
    *  Each bidder may submit any bid $b_A, b_B \geq 0$.
    *  The highest bidder wins, paying the second-highest bid.

---

## 3.1 Truthful Equilibrium

---

**Observation:** For each bidder, it is optimal to bid their actual valuation ($b_A=v_A$ and $b_B=v_B$) *no matter what the other bidder bids*.

**Proof:** Consider Alice (same proof for Bob)

* Suppose $b_A < v_A$, i.e., she bids under her valuation:
    * If Bob bids $b_B< b_A$, then Alice wins and pays $b_B$, and raising her bid would not have changed anything.
    * If Bob bids $b_B > v_A$, then Alice loses, and raising her bid to $v_A$ would not have changed anything.
    * However, if $b_B\in [b_A, v_A]$, bidding $v_A$ would have been better for Alice, as she would have won (and paid $b_B\leq v_A$).
    * Consequently, any $b_A < v_A$ is (weakly) dominated by bidding $v_A$.

---

**Proof: (cont'd)**

* Suppose $b_A> v_A$, i.e., she bids over her valuation:
    * If Bob bids $b_B< v_A$, then Alice wins and pays $b_B$, and lowering her bid to $v_A$ would not have changed anything
    * If Bob bids $b_B> b_A$, then Alice loses, and lowering her bid would not have changed anything.
    * However, if $b_B \in [v_A,b_A]$, Alice ``wins'' and pays $b_B\geq v_A$, so bidding $v_A$ would have been better for Alice.
    * Consequently, any $b_A > v_A$ is (weakly) dominated by bidding $v_A$.
* Together, we have the claim.

Notes:
* An player's action $\alpha$ is *weakly dominated* by another action $\beta$ if $\beta$ produces an output that is at least as good as the output produced by $\alpha$, no matter what the other player does.
* An player's action $\alpha$ is *strictly dominated* by another action $\beta$ if $\beta$ produces an output that is strictly better than the output produced by $\alpha$, no matter what the other player does.
* The proof can be easily generalized to any number of bidders, to obtain that in a second-price auction, any bidder's action is weakly dominated by bidding their own valuation.

---

## 3.2 Expected Revenue and Optimal Auctions

---

* The auctioneer's (i.e., seller's) expected revenue in the second-price auction is the expected value of the second highest valuation. 
* For two independent variables uniformly sampled between $0$ and $1$, the expected value of the minimum of these variables is $1/3\approx 0.33$ 
(further details in lecture notes).


Notes:
* Let $F(x)$ be the cumulative density function (CDF) of the lowest of Alice and Bob's valuations, $\min\{v_A, v_B\}$, where $v_A$ and $v_B$ are independent variables sampled uniformly from $[0,1]$.
* By definition, for any $x$ in $[0,1]$, $F(x)$ is the probability that the lower valuation is below $x$, or equivalently, $g(x):=1-F(x)$ is the probability that both valuations are above $x$; clearly $g(x)=(1-x)^2$, and hence $F(x)=1-(1-x)^2$.
* From the CDF, we can compute the probability density function (PDF) by derivation: $f(x)=\frac{d}{dx}F(x)=2(1-x)$.
* Finally, the expected value is computed from the PDF with the integral formula
$$\int_0^1 x\cdot f(x) dx = 2\int_0^1 (x-x^2)dx=2\cdot \left(\frac{1}{2}-\frac{1}{3}\right)=\frac{1}{3}.$$

---

* This is not quite as good as posting a price 
(which provided revenue $2/3\sqrt{1/3} \approx0.38$). 
* Why not? 
* Because the auction that we considered was not optimal for the auctioneer!
* The optimal auction involves a *reserve price* $r>0$: 
    * If no bid is above $r$, nobody wins. 
    * If one bid is above $r$, the payment is $r$.
    * If both bids are above $r$, the payment is the second-highest bid.

---

* Under a reserve price $r$, it is still optimal for all bidders to be truthful, hence the expected revenue is  
\begin{align}
\rho(r)&= 0\cdot Pr[v_A, v_B<r] + r\cdot Pr\Big[\min\{v_A, v_B \} \leq r \leq \max\{v_A, v_B \}\Big] \\
&+ E\Big[\min\{v_A, v_B\} \ | \ r\leq \min\{v_A, v_B\} \Big] \cdot Pr\Big[r\leq \min\{v_A, v_B\} \Big] \\
&= \frac{1}{3} + r^2 - \frac{4}{3}r^3.
\end{align}
(details in lecture notes)

Notes: 
* Clearly, the prob. that both valuations are below $r$ is $r^2$, the prob. that both valuations are above $r$ is $(1-r)^2$, and the prob. that $r$ is in between the valuations is $2r(1-r)$. You can check that these probabilities sum up to one.
* Hence, out of the three terms above for the expected revenue, the first term is zero and the second term is $2r^2(1-r)$.
* To compute the third term, we simply copy the integral formula for the expected value (from two slides ago), but we restrict the integration limits to $[r, 1]$:
\begin{align}
\int_r^1 x\cdot f(x) dx &= 2\int_r^1 (x-x^2)dx\\
&=2\cdot \left[\frac{x^2}{2}-\frac{x^3} {3}\right]_r^1 \\&=\frac{1}{3} - r^2 + \frac{2}{3}r^3.
\end{align}
* Putting all terms together, we obtain that the expected revenue is 
$$\rho(r)=0+2r^2(1-r)+\left(\frac{1}{3} - r^2 + \frac{2}{3}r^3\right)=\frac{1}{3}+r^2-\frac{4}{3}r^3.$$

---

![](https://i.imgur.com/bx9RDse.png)

Plot of the auctioneer's expected revenue, $\rho(r)=1/3 + r^2 - 4r^3/3$, as a function of $r$.

* The expected revenue is maximal for $r=1/2$, at which point it is $5/12\approx 0.42$. 
* **Optimal Auctions (Myerson, 1981)** If the aim is to maximize revenue in an auction, then the auction will often have a reserve price!

Notes:
* In the plot, we see that revenue is increasing at $r=0$. So, a positive reserve price is optimal.
* If the auctioneer chooses a reveal price of $r=1/2$, their expected revenue is around $0.42$, so this auction is better than the posted price.
* To maximize the auctioneer's expected revenue function $\rho(r)$ above: we evaluate the function at all the local extrema (minima and maxima). Since the function is continuous and differentiable, the local extrema are found at the borders $r=0$ and $r=1$, and at the roots of the derivative $\rho'(r)=2r-4r^2=0$. These roots are $r=0$ and $r=1/2$. By inspecting all these points, we find that the global maximum is found at $r=1/2$, with a value of $\rho(1/2)=5/12$.

---

# 4. English Auction

---

* In the English auction, 
    * an auctioneer continually raises the price,
    * bidders that accept the price stay in the race,
    * while those that do not accept it leave, and
    * the auction runs until a last bidder remains active.
* The price at which the second-to-last bidder leaves is then the payment of the winner.

---

## 4.1 Strategic Equivalence to SPA

---

* The English auction is strategically equivalent to the static Second-Price Auction.
* Specifically, it is a (weakly) dominant strategy to stay in the auction until the price reaches one's valuation.
* Doing so, the expected payment is the also the same: the expected second highest valuation.
* Consequently, the English auction is also revenue equivalent to the second-price auction for the auctioneer.

---

## 4.2 The Problem of Shill-Bidding

---

* While the Second-Price Auction and the English auction are very popular among theorists, they are not so popular among practitioners.
* One reason is that it is prone to *shill-bidding*.
* Shill-bidder: Bidder that acts on behalf of the auctioneer to drive up the price (at no cost if he doesn't win).
* Aside: This also a primary reason why Polkadot employs an auction format in which you pay what you bid.

---

# 5. First-Price Auction and Dutch Auction

--- 

## 5.1 The static first-price auction

---

* In the static first-price auction, the winning bidder pays her bid.
* The rest of the rules are the same as in the second-price auction; i.e., 
    * all bidders submit their bids simultaneously,
    * the highest bid wins.

---

**Claim:** In a first-price auction with two players, where the valuations are independent uniform values on $[0,1]$, it is an equilibrium for both bidders to bid half of their valuations, i.e., $b_A = v_A/2$ and $b_B=v_B/2$.

**Proof:**
* Consider Alice, and assume Bob bids $b_B=v_B/2$ (same analysis for Bob).
* Alice's expected utility when submitting a bid $b$ is 
\begin{align}
(v_A-b)\cdot Pr[b_B \leq b] &= (v_A-b)\cdot Pr[v_B/2 \leq b] \\
&= (v_A-b)\cdot Pr[v_B \leq 2b] \\
&= (v_A-b)\cdot 2b.
\end{align}
* It can be checked that this value is maximized when $b=v_A/2$, for which Alice obtains an expected utility of $v_A^2/2$.
* In summary, if Bob plays $b_B=v_B/2$, then it is optimal for Alice to play $b_A=v_A/2$, and vice-versa.
* Together we have a Nash equilibrium.

Notes:
* Definition of a Nash equilibrium..

---

* Bidding in the first-price auction is **not** truthful.
* Bidders *shade* their bid; i.e., they bid below their value.
* It is clear that bidding truthfully can never be optimal: if you win, you earn nothing.
* So, bidding below your value is strictly better because you still win sometimes but now earn strictly positive utility.

---

* What is the expected revenue of the first-price auction?
* The distribution of the highest valuation between the two bidders is $F(x)=x^2$.
* Then, expected revenue is $$R = \int\limits_0^1 \frac{v}{2} f(v)\mathrm d v = \int\limits_0^1 v^2 \mathrm d v = \frac{1}{3}.$$
* This is the same revenue as in the second-price auction!

---

* **Revenue Equivalence Theorem (Myersion, 1981):** When valuations are independent and private as in our model, then *all auction mechanisms* that allocate the good to the highest-valuing bidder in equilibrium are *revenue equivalent*. 
* First-price vs. second-price auction: In the first-price auction, bidders bid below their valuation. At the same time, they have to pay their bid when winning. Together, this gives the same expected payment as the second-price auction.

---

## 5.2 Dutch Auction

---

* In the Dutch auction, the auctioneer continually lowers the price until the first bidder accepts.
* The first bidder that accepts obtains the good and pays the price she accepted.
* It turns out that the Dutch auction is strategically equivalent to the first-price auction.
* The tradeoffs that the bidders face are very similar: take the current price or wait a bit at the risk of another bidder accepting first.

---

## 5.3 Front-Running

---

* An annoying problem for auctions on the blockchain is *front-running*.
* Front-running: Seeing and reacting to other bidders' bids before they are written onto the chain.
* Static first-price auction: Don't bid $b_i=v_i/2$ but just slightly outbid highest bid in the mempool.
* Problem: potentially inefficient outcome; i.e., not the highest valuing bidder wins.

---

# 6. Candle Auction and Polkadot

---


* Blockchain auctions face two major problems:
    * Valuations of smart contracts are known.
    * Front running: Upcoming bids are known.
* The first means: no second-price auctions (neither static nor English), because of potential shill bidding.
* The second means: no first-price auction.

---

* Polkadot's solution: candle auction.
* Candle auction: dynamic first-price auction with random ending time.
* In Polkadot, the candle auction rule is used in a *Package auction*, in which you can bid on several packages of goods rather than a single one. 

![](https://i.imgur.com/23Y8Cyv.jpg)

Notes: 
* Tell students that we will explain the details of the polkadot auctions in a minute, when we run the candle auction experiment with them.

---

* W3F research shows: candle auction mitigates front-running problems (in the single good case).
* Another side-effect of candle: no sniping.
* After the break, we will play a candle auction.

---

# Workshop (90 mins)

## Candle Auction (30 min)

- Might make sense as last activity in the lesson.
- Big Final: Students have the chance to use the budget they accumulated during the last lessons to bid for special NFTs in a one-shot candle auction.
- We didive students into groups of 3-4 to bid.
- The Candle Auction can last longer (say 30 seconds preparation phase + 5 min bidding phase).
- Auction off several NFTs in a oTree Candle Auction.
- This is an experiment that W3F research (Florian, Jonas, Samuel) has implemented to be played in a lab.
- The students will get the necessary instructions on their screens.
- **Results**: As this is the last lesson, we will also immediately present the results of the auction, show average prices per markets, when the candle went out, etc.

## More Activites