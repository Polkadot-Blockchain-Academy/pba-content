<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <title>State Machines</title>
  <link rel="icon" href="./../../assets/favicon.svg" />
  <link rel="shortcut icon" href="./../../assets/favicon.png" />
  <link rel="stylesheet" href="./../../dist/reset.css" />
  <link rel="stylesheet" href="./../../dist/reveal.css" />
  <link rel="stylesheet" href="./../.././assets/styles/PBA-theme.css" id="theme" />
  <link rel="stylesheet" href="./../../css/highlight/shades-of-purple.css" />

  <link rel="stylesheet" href="./../.././assets/styles/custom-classes.css" />

</head>

<body class="site">
  <header class="site-header">
    <!-- This logo is a link only on the watching server, not the production build -->
    <a href="">
      <img style="height: 2.5vw;" class="watermark-logo" src="./../../assets/img/0-Shared/logo/pba-logo-white.svg"
        alt="PBA Logo">
    </a>
  </header>
  <main class="reveal">
    <article class="slides">
      <section  data-markdown><script type="text/template">

# State Machines
</script></section><section ><section data-markdown><script type="text/template">
## State Machines

We can formalize this notion of shared story with state machine model.

<img width="800px" src="./img/state-machine/state-machine-general.svg" />

<aside class="notes"><p>Most systems that we care about can be modeled as state machines. A state machine is not a real machine that you can touch. It is a model comprised of a set of states and a set of rules about how to transition between the states.</p>
</aside></script></section><section data-markdown><script type="text/template">
## Labelled Transition Systems

Sometimes you can map the entire state space as an LTS.

Other times it is too big.

<img src="./img/state-machine/state-machine-arbitrary-history.png" />

<aside class="notes"><p>Consider if we tried to map all possible states of a social media app or a digital currency. Sometimes an LTS drawing like this is useful, other times it would be too large or even infinite. Even still, sometimes drawing part of it can help you think about what the states and transitions might be.</p>
<p>Example: Audio Amplifier</p>
<p>There are three buttons (louder, quieter, mute). The amplifier&#39;s volume output can be one of four levels: Silent, Quiet, Normal, Loud. Volume up and down should be pretty clear. When you mute the output immediately goes silent, and when you unmute it goes back to whatever it was before.</p>
<p>Q: How should we model the states?
A: We could make the states directly be the volume levels. Let&#39;s try that.</p>
<p>Q: Is this enough? How do we unmute?
A: Gonna need to store the &quot;previous_volume&quot;</p>
</aside></script></section><section data-markdown><script type="text/template">
## Example: Light Switch

Simple Switch: 2 States, 1 Transition

**Labelled Transition System** <!-- .element: class="fragment" data-fragment-index="2" -->

<img src="./img/state-machine/light-switch-lts.svg" /> <!-- .element: class="fragment" data-fragment-index="2" -->

**History** <!-- .element: class="fragment" data-fragment-index="3" -->

<img src="./img/state-machine/light-switch-history.svg" /> <!-- .element: class="fragment" data-fragment-index="3" -->
</script></section><section data-markdown><script type="text/template">
## State Machine Example: Digital Cash

Each state is a set of bank notes. Where a bank note has an amount and an owner.
A transition involves a user consuming (spending) some bank notes and creating new ones.

<img width="800px" src="./img/state-machine/state-machine-cash.svg" />

<aside class="notes"><p>Not all conceivable transitions are valid. Imagine a user consuming a bank note worth 5 coins, and creating two new ones each worth 3 coins.</p>
</aside></script></section><section data-markdown><script type="text/template">
## Sate Machine Example: Social Media

Each state is a set of posts and their associated comments and emoji reaction counts.
A transition involves, making a new post, or reacting to someone elses, or commenting

<img src="./img/state-machine/state-machine-social.svg" />

<aside class="notes"><p>There is not a single model here. Some state machines will allow deleting or editing posts, while others will not. Some will allow disliking posts while others only allow liking.</p>
</aside></script></section><section data-markdown><script type="text/template">
## More State Machine Examples:

<pba-flex center>

- Light Control in this room
- A Car-style Transmission vs a Motorcycle-style Transmission
- Hotel Elevator
- Roulette table

</pba-flex>

<aside class="notes"><p>Let&#39;s brainstorm what the state and the transitions might be for each of these.</p>
<p>Feel free to simplify these as necessary.</p>
</aside></script></section><section data-markdown><script type="text/template">
## Shared Story of a State Machine

<pba-cols>
<pba-col>
<pba-flex center>

If we agree on:

- The starting state<br/>(aka genesis state)
- The history of transitions

</pba-col>
<pba-col>
</pba-flex>

Then we _MUST_ agree on:

<pba-flex center>

- The current state

</pba-flex>

</pba-col>
</pba-cols>

<aside class="notes"><p>Now that we have a formal math-y model of systems that we care about, we can see that the notion of shared stories being powerful is more than slick language of philosophical mumbo jumbo. Even the term genesis state (or genesis block) is taken straight from mythology. We aren&#39;t newly discovering or inventing the idea that having a shared understanding of our past is important. It dates back to pre-history. We are just formalizing it and applying it to digital services.</p>
<p>I have a talk from 2020 that goes into more detail and philosophy about this shared history idea and its relation to blockchain:
<a href="https://www.youtube.com/watch?v=FZXk3_RTvfc">https://www.youtube.com/watch?v=FZXk3_RTvfc</a></p>
<p>It is one of my favorite talks I&#39;ve ever given.</p>
</aside></script></section></section><section ><section data-markdown><script type="text/template">
## Blockchains (Finally)

A blockchain can be thought of in three parts

<pba-cols>
<pba-col>
<pba-flex center>

**State Machine**

What does the state hold?

What are the _rules_ to change it?

</pba-flex>
</pba-col>
<pba-col>
<pba-flex center>

**Shared History** (data structure)

Which potential histories exist?

</pba-flex>
</pba-col>
<pba-col>

<pba-flex center>

**Consensus**

Which history is the real one?

What part of history is final?

</pba-flex>
</pba-col>
</pba-cols>

<aside class="notes"><p>Let&#39;s end this lesson with a little history of what we have seen in the blockchain space so far.</p>
<p>First, each blockchain tracks some state machine. We&#39;ve discussed several examples of what that might be already, we&#39;ll code some simple examples shortly, and we&#39;ll spend all of module 5 digging into how to create a blockchain-friendly production-ready state machine.</p>
<p>Next is the Blockchain Data structure. This data structure is basically a linked list of state transitions. But unlike the linked lists you studied in your data structures course, it isn&#39;t just linked by memory addresses or any other malleable thing. Instead it is cryptographically linked so that if anyone presents a different history, you can tell right away that you don&#39;t agree on a shared history. We&#39;ll dive into this data structure in the next lesson.</p>
<p>Finally, is a consensus mechanism. Defining a state machine alone does not uniquely define a history. There are many possible valid histories. Just like the many worlds interpretation of quantum mechanics. To really agree on the current state, we need to agree on which of the possible histories is the real one.</p>
</aside></script></section><section data-markdown><script type="text/template">
## Short History of Blockchains
</script></section><section data-markdown><script type="text/template">
## Bitcoin

<img rounded style="width: 500px;" src="./img/state-machine/bitcoin-transaction.png" />

Uses an unspent transaction output (UTXO) model & Proof of Work (PoW) consensus. <!-- .element: class="fragment" -->

<aside class="notes"><p>Who knows where the figure is from?</p>
<p>CLICK</p>
<p>Bitcoin was first.
It was a money app.
The first app chain.
It hosts a smart contract in the broad definition.</p>
<p>It was the first time most people considered a digital service that was not run by a particular person.</p>
<p>Figure source: <a href="https://bitcoin.org/en/bitcoin-paper">Bitcoin white paper</a></p>
</aside></script></section><section data-markdown><script type="text/template">
## Litecoin, Monero, Dogecoin

<img src="./img/state-machine/altcoins.png" />

<aside class="notes"><p>Only a few year later people realized they could fork the code and make small changed and improvements.
Some changes were trivial.
Some were interesting: monero and privacy.</p>
<p>For me personally, this was a small crisis.
I thought bitcoin was the one global one.
Aren&#39;t these other coins undermining the narrative?
NO! The point is that anytime you don&#39;t like the system or have an idea for a better one, you can do it!
If you don&#39;t like bitcoin, build your own coin and make it better.
Let the market decide.</p>
</aside></script></section><section data-markdown><script type="text/template">
## Ethereum and Smart Contracts

- Generalization of Bitcoin: provides a quasi-Turing-complete VM
- Uses an account-based system
- Accounts can store balances, but can also store executable code (smart contracts)
- Each contract can have its own internal state and API
</script></section><section data-markdown><script type="text/template">
## Polkadot, Cosmos, Avalanche, Near, ...

<aside class="notes"><p>Iterations on Ethereum&#39;s general computing platform. Strive for scalability interoperability etc. Experiment with different consensus models.</p>
</aside></script></section></section>
    </article>
  </main>

  <script src="./../../dist/reveal.js"></script>

  <script src="./../../plugin/markdown/markdown.js"></script>
  <script src="./../../plugin/highlight/highlight.js"></script>
  <script src="./../../plugin/zoom/zoom.js"></script>
  <script src="./../../plugin/notes/notes.js"></script>
  <script src="./../../plugin/math/math.js"></script>

  <script src="./../../assets/plugin/mermaid.js"></script>
  <script src="./../../assets/plugin/mermaid-theme.js"></script>

  <script src="./../../assets/plugin/chart/chart.js"></script>
  <script src="./../../assets/plugin/chart/chart.min.js"></script>

  <script src="./../../assets/plugin/tailwindcss.min.js"></script>

  <script>
    function extend() {
      var target = {};
      for (var i = 0; i < arguments.length; i++) {
        var source = arguments[i];
        for (var key in source) {
          if (source.hasOwnProperty(key)) {
            target[key] = source[key];
          }
        }
      }
      return target;
    }

    // default options to init reveal.js
    var defaultOptions = {
      controls: true,
      progress: true,
      history: true,
      center: true,
      transition: 'default', // none/fade/slide/convex/concave/zoom
      slideNumber: true,
      mermaid: {
        startOnLoad: false,
        logLevel: 3,
        theme: 'base',
        themeVariables: {
          primaryColor: purple,
          primaryTextColor: white,
          primaryBorderColor: pink,
          lineColor: pink,
          secondaryColor: lightPurple,
          tertiaryColor: lightPurple,
        },
      },
      chart: {
        defaults: {
          color: 'lightgray', // color of labels
          scale: {
            beginAtZero: true,
            ticks: { stepSize: 1 },
            grid: { color: "lightgray" }, // color of grid lines
          },
        },
        line: { borderColor: ["#ccc", "#E6007A", "#6D3AEE"], "borderDash": [[5, 10], [0, 0]] },
        bar: { backgroundColor: ["#ccc", "#E6007A", "#6D3AEE"] },
      },
      plugins: [
        RevealMarkdown,
        RevealHighlight,
        RevealZoom,
        RevealNotes,
        RevealMath,
        RevealMermaid,
        RevealChart
      ]
    };

    // options from URL query string
    var queryOptions = Reveal().getQueryHash() || {};

    var options = extend(defaultOptions, {"width":1400,"height":900,"margin":0,"minScale":0.2,"maxScale":2,"transition":"none","controls":true,"progress":true,"center":true,"slideNumber":true,"backgroundTransition":"fade"}, queryOptions);
  </script>


  <script>
    Reveal.initialize(options);
  </script>
</body>

</html>
