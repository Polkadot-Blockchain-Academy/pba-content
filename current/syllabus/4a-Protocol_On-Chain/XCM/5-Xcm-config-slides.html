<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <title>XCM Configuration</title>
  <link rel="icon" href="./../../../assets/favicon.svg" />
  <link rel="shortcut icon" href="./../../../assets/favicon.png" />
  <link rel="stylesheet" href="./../../../dist/reset.css" />
  <link rel="stylesheet" href="./../../../dist/reveal.css" />
  <link rel="stylesheet" href="./../../.././assets/styles/PBA-theme.css" id="theme" />
  <link rel="stylesheet" href="./../../../css/highlight/shades-of-purple.css" />

  <link rel="stylesheet" href="./../../.././assets/styles/custom-classes.css" />

</head>

<body class="site">
  <header class="site-header">
    <!-- This logo is a link only on the watching server, not the production build -->
    <a href="">
      <img style="height: 2.5vw;" class="watermark-logo" src="./../../../assets/img/0-Shared/logo/pba-logo-white.svg"
        alt="PBA Logo">
    </a>
  </header>
  <main class="reveal">
    <article class="slides">
      <section ><section data-markdown><script type="text/template">

# XCM Config

<aside class="notes"><p>We mentioned the executor is highly configurable.
What can we configure?</p>
</aside></script></section><section data-markdown><script type="text/template">
## What you'll learn

<pba-flex center>

- Different configuration items available in the XCM executor.
- The tools available to help you configure them.
</script></section></section><section  data-markdown><script type="text/template">
# Config items

<pba-flex center>

- AssetTransactor
- Barrier
- IsReserve
- IsTeleporter
- LocationConverter
- Weigher

<aside class="notes"><p>We&#39;ll briefly introduce you to all these concepts.
It might be a bit dry, but the idea is to jump straight to the workshop afterwards.</p>
<p>These are all associated types on an <code>XcmConfig</code> struct.</p>
</aside></script></section><section ><section data-markdown><script type="text/template">
# Asset Transactor
</script></section><section data-markdown><script type="text/template">
<pba-flex center>

Assets can live in different pallets:

- pallet-balances
- pallet-assets
- pallet-nfts

You can even have multiple instances of these pallets!
</script></section><section data-markdown><script type="text/template">
How does the XCM executor know where each asset lives?

You configure it!

<!-- .element: class="fragment" data-fragment-index="1" -->
</script></section><section data-markdown><script type="text/template">
## Available adapters

<pba-flex center>

- Fungible(s) adapter: pallet-balances/pallet-assets
<!-- .element: class="fragment" data-fragment-index="1" -->
- Nonfungible(s) adapter: pallet-uniques/pallet-nfts
<!-- .element: class="fragment" data-fragment-index="2" -->

<aside class="notes"><p>Although you can write your own logic for this, we have some available adapters
in the <code>polkadot-sdk</code> repo in the <code>xcm-builder</code> crate.
Each can be configured to support different assets.</p>
</aside></script></section><section data-markdown><script type="text/template">
## Example (continued)

<img src="img/Example Flow - Asset Transactor.png">

<aside class="notes"><p>DOT lives in <code>pallet-balances</code>.
USDT lives in an instance of <code>pallet-assets</code>.
<code>AssetTransactor</code> is a sequence of transactors, we try them one by now until one
matches the asset id.
We&#39;ll see how we can configure these later.</p>
</aside></script></section></section><section ><section data-markdown><script type="text/template">
# Barrier

By default we can receive any message from chains we are connected to.

Do we want to?

<!-- .element: class="fragment" data-fragment-index="1" -->

<aside class="notes"><p>The barrier lets us filter incoming messages based on their structure.
It&#39;s a firewall.</p>
</aside></script></section><section data-markdown><script type="text/template">
## A firewall for XCMs

Chains can configure its barrier to immediately filter unwanted messages.
</script></section><section data-markdown><script type="text/template">
<img src="img/Example Flow - Barrier (intro).png">

<aside class="notes"><p>Our example would need to pass the barrier to reach its destination and be executed.</p>
</aside></script></section><section data-markdown><script type="text/template">
<img src="img/Example Flow - Barrier (wrong origin).png">

<aside class="notes"><p>We can filter messages from unwanted origins.
We can also filter messages with unwanted instructions.
For example, this &quot;Random Action&quot; doesn&#39;t have to be a transfer, could be trying to execute anything.</p>
</aside></script></section><section data-markdown><script type="text/template">
## Available barriers

<pba-flex center>

- AllowTopLevelPaidExecutionFrom
<!-- .element: class="fragment" data-fragment-index="1" -->
- AllowExplicitUnpaidExecutionFrom
<!-- .element: class="fragment" data-fragment-index="2" -->
- ...
<!-- .element: class="fragment" data-fragment-index="3" -->

<aside class="notes"><p>These are two of the most relevant barriers provided.
There are more.
TODO: Would be good to have good documentation on barriers to link here.
You can of course write your own and filter whatever you want.
They come with some degree of customizability.</p>
</aside></script></section><section data-markdown><script type="text/template">
### AllowTopLevelPaidExecutionFrom

<img src="img/Example Flow - Barrier (no fees).png">

<aside class="notes"><p>As long as they include the <code>PayFees</code> instruction, meaning they intend to pay fees,
this barrier will allow them to pass.</p>
</aside></script></section><section data-markdown><script type="text/template">
### AllowExplicitUnpaidExecutionFrom

<img src="img/Example Flow - Barrier (explicit unpaid).png">

<aside class="notes"><p>This barrier will allow messages from some origins when they use the <code>UnpaidExecution</code>
instruction.
These could be to allow messages from the system.
It&#39;s used a lot between system chains.</p>
</aside></script></section></section><section ><section data-markdown><script type="text/template">
# LocationConverter

Way to convert from `Location` to `AccountId`.

This is how we get sovereign accounts.

<aside class="notes"><p>We always deal with locations on XCM, never accounts.
This config item converts locations to accounts.
This means pallets can have account, external locations can also have accounts.</p>
</aside></script></section><section data-markdown><script type="text/template">
## Available converters

<pba-flex center>

- AccountId32Aliases
<!-- .element: class="fragment" data-fragment-index="1" -->
- HashedDescription
<!-- .element: class="fragment" data-fragment-index="2" -->

<aside class="notes"><p>The first just grabs an AccountId32 junction and gets the local account from it.
The second is very generic and can be used to generate accounts for any type of junction.</p>
</aside></script></section></section><section ><section data-markdown><script type="text/template">
## IsReserve and IsTeleporter

Specifies reserve locations for particular assets.
</script></section><section data-markdown><script type="text/template">
<img src="img/Example Flow - IsReserve.png">
</script></section><section data-markdown><script type="text/template">
<img src="img/Example Flow - IsTeleporter.png">
</script></section></section><section ><section data-markdown><script type="text/template">
## Weigher

The weigher weighs XCMs, it assigns a weight to each instruction.
</script></section><section data-markdown><script type="text/template">
### Available weighers

<pba-flex center>

- FixedWeightBounds (testing)
<!-- .element: class="fragment" data-fragment-index="1" -->
- WeightInfoBounds (production)
<!-- .element: class="fragment" data-fragment-index="2" -->

<aside class="notes"><p>FixedWeightBounds is only for testing, it assigns a constant weight to each instruction.</p>
<p>WeightInfoBounds uses benchmarks for assigning different weights to different instructions.</p>
</aside></script></section><section data-markdown><script type="text/template">
### Benchmarks!

XCM instructions need to be weighed by each runtime!

Different configuration items change the benchmarks.
</script></section><section data-markdown><script type="text/template">
<img src="img/Example Flow - Weigher.png">

<aside class="notes"><p>If you&#39;re using <code>pallet-assets</code> for example, instructions that use the <code>AssetTransactor</code>
will inevitably be more expensive.
Always benchmark the worst case.</p>
</aside></script></section></section><section  data-markdown><script type="text/template">
# Next steps

We'll look at the XCM emulator, a tool to let us experiment configuring XCM, sending and executing messages.
</script></section>
    </article>
  </main>

  <script src="./../../../dist/reveal.js"></script>

  <script src="./../../../plugin/markdown/markdown.js"></script>
  <script src="./../../../plugin/highlight/highlight.js"></script>
  <script src="./../../../plugin/zoom/zoom.js"></script>
  <script src="./../../../plugin/notes/notes.js"></script>
  <script src="./../../../plugin/math/math.js"></script>

  <script src="./../../../assets/plugin/mermaid.js"></script>
  <script src="./../../../assets/plugin/mermaid-theme.js"></script>

  <script src="./../../../assets/plugin/chart/chart.js"></script>
  <script src="./../../../assets/plugin/chart/chart.min.js"></script>

  <script src="./../../../assets/plugin/tailwindcss.min.js"></script>

  <script>
    function extend() {
      var target = {};
      for (var i = 0; i < arguments.length; i++) {
        var source = arguments[i];
        for (var key in source) {
          if (source.hasOwnProperty(key)) {
            target[key] = source[key];
          }
        }
      }
      return target;
    }

    // default options to init reveal.js
    var defaultOptions = {
      controls: true,
      progress: true,
      history: true,
      center: true,
      transition: 'default', // none/fade/slide/convex/concave/zoom
      slideNumber: true,
      mermaid: {
        startOnLoad: false,
        logLevel: 3,
        theme: 'base',
        themeVariables: {
          primaryColor: purple,
          primaryTextColor: white,
          primaryBorderColor: pink,
          lineColor: pink,
          secondaryColor: lightPurple,
          tertiaryColor: lightPurple,
        },
      },
      chart: {
        defaults: {
          color: 'lightgray', // color of labels
          scale: {
            beginAtZero: true,
            ticks: { stepSize: 1 },
            grid: { color: "lightgray" }, // color of grid lines
          },
        },
        line: { borderColor: ["#ccc", "#E6007A", "#6D3AEE"], "borderDash": [[5, 10], [0, 0]] },
        bar: { backgroundColor: ["#ccc", "#E6007A", "#6D3AEE"] },
      },
      plugins: [
        RevealMarkdown,
        RevealHighlight,
        RevealZoom,
        RevealNotes,
        RevealMath,
        RevealMermaid,
        RevealChart
      ]
    };

    // options from URL query string
    var queryOptions = Reveal().getQueryHash() || {};

    var options = extend(defaultOptions, {"width":1400,"height":900,"margin":0,"minScale":0.2,"maxScale":2,"transition":"none","controls":true,"progress":true,"center":true,"slideNumber":true,"backgroundTransition":"fade"}, queryOptions);
  </script>


  <script>
    Reveal.initialize(options);
  </script>
</body>

</html>
